# Lec 5 图像复原与重建

## 基本概念

常用图像复原（Image Restoration）处理大气湍流，运动模糊，离焦模糊等问题

- 图像降质（图像退化）

  - 象差与畸变：成像系统的局限性如带宽和畸变导致的图像失真
  - 噪声干扰：成像、 数字化及处理过程中引入噪声

- 图像增强（Enhancement）

  - 旨在改善图像质量， 提高图像的可懂度
  - 更偏向**主观**判断， 即要突出所关心的信息， 满足人的视觉系统， 具有好的视觉效果

- 图像复原（Restoration）

  - 根据图像畸变或退化的**客观**原因， 进行模型化处理， 将降质图像恢复到**原始图像**，因此必须根据一定的图像退化模型来进行图像复原

  - 核心思想：弄清楚降质/退化的原因，分析引起降质/退化的因素，建立数学模型，并沿着图像降质的逆过程回复图像

    1. 当缺少图像先验知识时，需对退化过程建立模型进行描述，再寻找一种去除或削弱其影响的方法；
    2. 当有足够的先验知识时，对原始图像建立一个数学模型并根据它对退化图像进行拟合，能够获得更好的复原效果

    ![image-20250417094902280](assets/数字图像处理Lec8_12.assets/image-20250417094902280.png)

- 图像退化/恢复模型

  ![image-20250417095014930](assets/数字图像处理Lec8_12.assets/image-20250417095014930.png)

  关于$h,\eta$的知识越多，估计图像越接近原始图像

## 噪声模型与图像复原

- 噪声来源

  - 在获取图像过程中，成像传感器主要受各种环境因素和传感元件本身的质量的影响
  - 在传输图像过程中，图像会因传输信道中的干扰而污染

- 噪声的分类：

  - 随机噪声

  - 脉冲噪声

  - 周期噪声

    图像中的周期噪声通常是在获取图像期间由电气或机电干扰产生的

    周期噪声是**空间依赖型噪声**，可通过频率域滤波来明显降低

- 噪声的特性

  - 空间特性：除周期噪声外，本章假设**噪声与空间坐标无关**，并且与图像本身也不相关
  - 频率特性：噪声在频域中的频率含量

下面介绍一些重要的噪声模型

- 高斯噪声：高斯分布

- 瑞利噪声：瑞利分布

- 爱尔兰（伽马）噪声：伽马分布

- 指数噪声：实数衰减

- 均匀噪声

- 椒盐噪声：随机出现的黑白像素点，由传感器故障或传输错误引起。

  <img src="assets/数字图像处理Lec8_12.assets/image-20250611202213126.png" alt="image-20250611202213126" style="zoom:67%;" />

然后我们对噪声进行建模和参数估计

- 周期噪声的参数估计通常是通过**检测图像的傅里叶谱**来估计的
- 噪声概率估计函数的参数

  1. 查传感器手册
  2. 通常情况下**需要估计**：获取一组“平坦”图像来分析噪声的情况
  3. 只能使用由传感器生成的图像时，可由一小片恒定的背景灰度来估计PDF的参数。根据其直方图的形状来确认最接近的PDF匹配

因为噪声是未知的，因此我们不能通过简单数学运算来得到$f(x,y)$，当只存在加性随机噪声时，可用空间滤波方法来估计

- 空间滤波器

  - 均值滤波器（算术均值滤波器、几何均值滤波器、**谐波/逆谐波均值滤波器**）

    几何均值滤波器实现的平滑可与算术平均滤波器的相比，但损失的图像细节更少

    | 滤波器类型                                   | 适用噪声类型                            | 备注                                                         |
    | -------------------------------------------- | --------------------------------------- | ------------------------------------------------------------ |
    | 算术平均滤波器和几何均值滤波器（尤其是后者） | 高斯噪声或均匀随机噪声                  | 更适合处理                                                   |
    | 谐波平均滤波器                               | 能处理盐粒噪声/类似于高斯噪声的其它噪声 | 不能处理胡椒噪声                                             |
    | 反谐波平均滤波器                             | 脉冲噪声                                | 更适合处理                                                   |
    | 反谐波平均滤波器                             | 暗噪声或亮噪声                          | 必须知道噪声是暗噪声还是亮噪声，以便为 $  Q  $ 选择合适的符号 |
    | 反谐波平均滤波器                             | 选错 $  Q  $ 的符号                     | 如果选错了 $  Q  $ 的符号，则会导致灾难性的后果              |

  - 统计排序滤波器（中值滤波器、最大/小值滤波器、中点滤波器、**修正阿尔法均值滤波器**）

    - 中值滤波器：与大小相同的线性平滑滤波器相比，它能有效地降低某些随机噪声，且模糊度要小很多。对于单极和双极**冲激噪声**，中值滤波器的效果更好

    - 最大值滤波器：降低胡椒噪声

    - 最小值滤波器：降低盐粒噪声

    - 中点滤波器：适合处理随机分布的噪声，如高斯噪声或均匀噪声

    - 修正阿尔法均值滤波器的

      在邻域$S_{xy}$删除$g(r,c)$的$\frac{d}{2}$个最低灰度值和最高灰度值，$g_r{(r,c)}$表示剩下的$mn-d$个像素
      $$
      \hat{f}(x,y) = \frac{1}{mn-d} \sum g_R(r,c),d\in [0,mn-1]
      $$

      - $d=0$，为算数平均滤波器
      - $d=mn-1$，为中值滤波器
      - 当d取其他值时，修正阿尔法滤波器**适合处理多种混合噪声**，如高斯噪声和椒盐噪声

  - 自适应滤波器（自适应局部噪声消除滤波器、**自适应中值滤波器**）

    自适应滤波器会根据𝒎 × 𝒏矩形领域$S_{xy}$定义的滤波区域内的图像的统计特性变化

    自适应滤波器的性能要优于前面讨论的所有滤波器，代价是增大了滤波器复杂度

    自适应中值滤波器：

    - 思路：改变窗口大小
    - 能处理更大概率的椒盐噪声。保留图像细节，平滑非冲激噪声

- 频域滤波器

  使用频带滤波器滤除**周期噪声**，在傅里叶变换中，周期噪声在对应于周期干扰的频率处显示为集中突发的能量，从而可以使用**选择性滤波器**来分离噪声

  - 带阻滤波器：某个频带中的频率被滤除
  - 带通滤波器：某个频带中的频率被通过
  - **陷波滤波器**：小频率矩形区域处理中的滤波器

## 线性位置不变退化模型*

图像退化/恢复模型

![image-20250610001431760](assets/数字图像处理Lec8_12.assets/image-20250610001431760.png)

退化图像可表示为：$g(x,y) = H[f(x,y)]+\eta (x,y)$为线性不变系统

- 线性不变系统

  - 空域的卷积表达式

    连续图像 $  f(x, y)  $ 可以看作是一系列点源组成，因此可表示为点源函数的卷积：

    $$
    f(x, y) = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(\alpha, \beta) \delta(x - \alpha, y - \beta) d\alpha \, d\beta
    $$

    代入 $  g(x, y) = H[f(x, y)]  $，并利用线性算子 $  H  $ 的可加性和齐次性：
    $$
    g(x, y) = H \left[ \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(\alpha, \beta) \delta(x - \alpha, y - \beta) d\alpha \, d\beta \right]
    $$

    $$
    = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} H[f(\alpha, \beta)] \delta(x - \alpha, y - \beta) d\alpha \, d\beta
    $$

    $$
    = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(\alpha, \beta) H[\delta(x - \alpha, y - \beta)] d\alpha \, d\beta
    $$

    > 点扩散函数（PSF）$h(x,\alpha,y,\beta) = H[\delta(x-\alpha,y-\beta)]$是系统对坐标$(x,y)$处的一个冲激响应

    代入H的冲激响应 $  h(x, \alpha, y, \beta) = H[\delta(x - \alpha, y - \beta)]  $ 可得：
    $$
    g(x, y) = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(\alpha, \beta) h(x, \alpha, y, \beta) d\alpha \, d\beta
    $$
    由H的位置不变性 $  H[\delta(x - \alpha, y - \beta)] = h(x - \alpha, y - \beta)  $，可简化为：
    $$
    g(x, y) = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(\alpha, \beta) h(x - \alpha, y - \beta) d\alpha \, d\beta
    $$

    空间域中退化图像为 $  g(x, y) = (h * f)(x, y)  + \eta(x,y)$

    - 频域的乘积表达式

      频率域中退化图像为 $  G(u, v) = H(u, v) F(u, v) +N(u,v)$

- 空域的矩阵表达式

几种典型的退化模型

- 光学散焦（光学系统散焦传递函数）
- 湍流模型（大气湍流造成的退化）
- 运动模糊模型（目标相对运动造成的退化）

## 非约束复原和约束复原*

- 非约束复原

  - 逆滤波（反卷积） 复原方法

    - 无噪声情况下的复原公式：
      $$
      \hat{F}(u, v) = \frac{G(u, v)}{H(u, v)}
      $$

      其中：

      - $ \hat{F}(u, v) $：复原图像的傅里叶变换
      - $ G(u, v) $：退化图像的傅里叶变换
      - $ H(u, v) $：退化函数的傅里叶变换

    - 含噪声情况下的复原公式：
      $$
      \hat{F}(u, v) = \frac{H(u, v) F(u, v) + N(u, v)}{H(u, v)} = F(u, v) + \frac{N(u, v)}{H(u, v)}
      $$

      > 最小二乘寻找最优估计图像

      其中：

      - $ N(u, v) $：噪声的傅里叶变换
      - 第二项 $ \frac{N(u, v)}{H(u, v)} $ 表示噪声被退化函数放大后的影响

    - 病态问题：

      - 当$H(u,v)$很小或等于0，即出现了零点时，会导致不定解
      - 即使没有噪声$N(u,v)$，一般也不可能精确地复原$f(x,y)$
      - 如果考虑噪声项$N(u,v)$，则出现零点时噪声项将被放大，零点的影响对复原的结果起主导地位

      对病态问题的改进方法之一（低通滤波）

      考虑到退化系统的传递函数 $H(u,v)$ 的带宽比噪声的带宽要窄很多，其频率特性具有低通特性（噪声高频信号），则可取恢复转移函数 $M(u,v)$ 为

      $$
      M(u,v) = \begin{cases} \frac{1}{H(u,v)}, & u^2 + v^2 \leq \omega_0^2 \\1 & u^2 + v^2 > \omega_0^2\end{cases}
      $$

      复原过程为 $\hat{F}(u,v) = M(u,v)G(u,v)$

      > 使用逆滤波常效果较差

  - 维纳滤波器：最小均方误差

    - 目标：寻求最佳复原图像 $\hat{f}$，使得均方误差 $e^2 = E\left\{ \left| f - \hat{f} \right|^2 \right\}$ 最小。

    - 最优估计在频率域中的表达式为：
      $$
      \hat{F}(u,v) = \frac{H^*(u,v)}{|H(u,v)|^2 + S_\eta(u,v)/ S_f(u,v)} G(u,v)
      $$
      其中：

      - $\hat{F}(u,v)$：退化图像的估计傅里叶变换
      - $G(u,v)$：退化图像的傅里叶变换
      - $H(u,v)$：退化传递函数
      - $H^*(u,v)$：$H(u,v)$ 的共轭
      - $|H(u,v)|^2$：$H(u,v)H^*(u,v)$
      - $S_\eta(u,v)$：噪声的功率谱
      - $S_f(u,v)$：未退化图像的功率谱

      维纳滤波器没有逆滤波中退化函数为0的问题。

      考虑到噪声功率谱 $S_\eta$ 和未退化图像的功率谱 $S_f$ 未知或不能估计时，需要对 $\hat{F}$ 进行近似。

- 约束复原

  - 约束最小二乘法图像复原（滤波）

    - 约束最小二乘滤波法的核心是𝑯对噪声敏感的问题：降低其对噪声敏感的一种方法是以**平滑测度的最优复原为基础**，如一幅图像的二阶导数（拉普拉斯算子）

    - 当𝑄为拉普拉斯算子时，可以得到常用的约束最小二乘滤波方法

    - 最优估计 $\hat{f}$ 在频域中的表达式为

      $$
      \hat{F}(u,v) = \left[ \frac{H^*(u,v)}{|H(u,v)|^2 + \gamma |P(u,v)|^2} \right] G(u,v)
      $$
      $\gamma$ 是一个可调整约束条件的参数

      $P(u,v)$ 是拉普拉斯算子 $p(x,y) = \begin{bmatrix} 0 & -1 & 0 \\ -1 & 4 & -1 \\ 0 & -1 & 0 \end{bmatrix}$ 的傅里叶变换

维纳滤波和最小二乘滤波的去模糊比较

- 低噪声下两者差不多
- 约束最小二乘滤波擅长处理高噪声和中噪声的情况

## 其他图像复原技术

- 几何失真矫正

  - 先确定一副图像为基准，然后去校正另一幅图像的几何形状

  - 根据两幅图像的一些已知对应点对（也称为控制点对）建立起函数关系式来进行映射

  - 图像经几何位置校正后，在校正空间中各像素的灰度值等于被校正图像对应点的灰度值

  - 一般校正后的图像某些像素点可能挤压在一起，或者分散开，不会恰好落在坐标点上

  - 需要内插法来求得这些像素点得灰度值

    - 最近邻点法

      取与像素点相邻的四个点中距离最近的领点灰度值作为该点的灰度值

      计算简单，但精度不高，同时校正后的图像亮度有明显的**不连续性**

    - 双线性插值法

    - 三次内插法

- 空间几何坐标变换

  图像的几何变换不改变像素的值，只改变像素的位置
