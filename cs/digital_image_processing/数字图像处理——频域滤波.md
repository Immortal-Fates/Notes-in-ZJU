# Lec 4 频域滤波（一）

## 基本概念

- 傅里叶级数: 任何**周期函数**都可表示为不同频率的正弦函数和/或余弦函数之和，其中每个正线函数和/或余弦函数都乘以不同的系数（我们现在称该和为傅里叶级数）。

- 傅里叶变换: 任何**非周期函数**都可表示为正弦函数和/或余弦函数乘以加权函数的积分。

- 单变量的傅里叶变换

  - 连续函数的傅里叶变换：频谱反映了输入信号的频率构成

    当一个一维信号$f(x)$满足狄里赫莱条件时，其傅里叶变换和逆变换一定存在
    $$
    F[f(x)] = F(u) = \int_{-\infty}^{+\infty} f(x)e^{-j2\pi ux} dx
    $$

    $$
    F^{-1}[F(u)] = f(x) = \int_{-\infty}^{+\infty} F(u)e^{-j2\pi ux} du
    $$

    x称为时域变量，u称为频域变量

    公式中使用了积分符号和复指数函数，其中 $  j  $ 表示虚数单位，满足 $  j^2 = -1  $

## 取样函数的傅里叶变换

奈奎斯特采样定理

- 条件：采样频率 $ f_s \geq 2f_{max} $（避免混叠）。

- 混叠现象：高频信号被误认为低频（如锯齿状边缘）。

  混叠情况下， 重建连续信号是不可能的

  ![image-20250324103124135](assets/数字图像处理——频域滤波.assets/image-20250324103124135.png)

- 解决方法：预滤波（如高斯模糊）去除高频分量。

取样与离散信号

- 取样信号：
  $$
  \tilde{f}(t) = f(t)S_{\Delta T}(t)=\sum f(n\Delta T)\delta(t-n\Delta T)
  $$

- 取样信号频谱为原信号频谱的周期性延拓：——连续函数
  $$
  \tilde{F}(\mu) = \frac{1}{\Delta T} \sum_{n=-\infty}^{\infty} F\left(\mu - \frac{n}{\Delta T}\right)
  $$

## 离散傅里叶变换

离散傅里叶变换(Discrete Fourier Transform, DFT)

- 一维离散傅里叶变换
  $$
    F(u) = \sum_{x=0}^{N-1} f(x) e^{-j2\pi ux/N}
  $$

  通常傅里叶变换为复数形式：$F(u)=R(u)+jI(u)=|F(u)|e^{j\varphi(u)}$

  - 频谱与相位谱：

    - 幅度谱：$ |F(u)| = \sqrt{R^2(u) + I^2(u)} $
    - 相位谱：$ \varphi(u) = \arctan\left(\frac{I(u)}{R(u)}\right) $
    - 能量谱（功率谱）：$E(u)=|F(u)|^2$

- 二维离散傅里叶变换

  二维数据$t\prime~~t\prime\prime$，称为空间域
  $$
  F(u, v) = \frac{1}{MN} \sum_{x=0}^{M-1} \sum_{y=0}^{N-1} f(x, y) e^{-j2\pi(ux/M + vy/N)}
  $$
  $F(0,0)$有时被称为频谱的直流分量

  ![image-20250324102059618](assets/数字图像处理——频域滤波.assets/image-20250324102059618.png)

  | 性质       | 描述                                            |
  | ---------- | ----------------------------------------------- |
  | **平移性** | 空域平移对应频域相位变化，幅度谱不变。          |
  | **对称性** | 实信号频谱共轭对称：$ F(u, v) = F^*(-u, -v) $。 |
  | **旋转性** | 空域旋转角度对应频域相同角度旋转。              |

  应用场景

  - **频域滤波**：低通（去噪）、高通（边缘增强）。
  - **图像重建**：仅用相位谱或幅度谱重建图像（相位谱主导结构信息）。

二维离散卷积定理：
$$
\begin{aligned}
f(x, y) \ast h(x, y) &\iff F(u, v)H(u, v) \\
f(x, y)h(x, y) &\iff F(u, v) \ast H(u, v)
\end{aligned}
$$
滤波器在空间域和频率域的表示组成了一个傅里叶变换对

![image-20250611235223979](assets/数字图像处理——频域滤波.assets/image-20250611235223979.png)

## 快速傅里叶变换（FFT）

算法优势

- 计算复杂度从 $ O(N^2) $ 降至 $ O(N \log N) $（如Cooley-Tukey算法）。
- 核心思想：分治法（递归分解DFT为更小的DFT）。

分步实现

1. 奇偶分解：将信号分为偶数项和奇数项。
2. 递归计算：组合小规模DFT结果。

## 小波变换基本概念

### 小波函数

小波是在有限时间范围内变化且其平均值为零的**数学函数**

![image-20250324105901214](assets/数字图像处理——频域滤波.assets/image-20250324105901214.png)

小波基函数

![image-20250612000056309](assets/数字图像处理——频域滤波.assets/image-20250612000056309.png)

### 核心思想

小波变换（wavelet transform， WT）

- 核心思想是将信号表示为不同尺度（scale）和平移（shift）的小波的线性组合
- 核心优势：同时捕捉信号的时域和频域局部特征。
- 基函数：有限持续时间的小波基（如Haar、Mexican Hat）。

| 特性         | 傅里叶变换               | 小波变换                   |
| ------------ | ------------------------ | -------------------------- |
| **基函数**   | 无限长正弦波             | 有限持续时间小波           |
| **适用场景** | 平稳信号（整体频率分析） | 非平稳信号（局部瞬态特征） |

信号分析是为了获得时间和频率之间的关系

傅立叶分析

- 用一系列不同频率的正弦波表示一个信号

- 一系列不同频率的正弦波是傅立叶变换的基函数

- 傅里叶理论只有频率分辨率而没有时间分辨率。

  可确定信号中包含哪些频率的信号， 但不能确定具有这些频率的信号出现在什么时候

小波分析

- 把一个信号分解为母小波通过移位和缩放后得到的一系列小波
  - 通过缩放母小波的宽度来获得**信号的频率特征**
  - 通过平移母小波来获得**信号的时间信息**
- 小波是一类在有限区间内快速衰减到0的函数， 其平均值为0，小波趋于不规则、 不对称
- 相比傅里叶变换，小波变换能够更好地捕捉信号的局部特征，因为它具有局部时间特性（小波函数在时间上具有紧支集（compact support），意味着它们在短时间内内具有显著的能量集中，可以更好地描述信号的瞬态变化），局部频率特性（通过改变小波的尺度参数，可以调整小波的频率，从而适应不同频率成分的信号）

- 凡能用傅立叶分析的函数都可用小波分析， 小波变换可理解为用经过缩放和平移的一系列函数代替傅立叶变换用的正弦波
- 用不规则的小波分析变化激烈的信号比用平滑的正弦波更有效， 或者说对信号的基本特性描述得更好

### 多分辨分析中的小波变换

多分辨率分析

- 在同时存在小型和大型物体， 或低对比度和高对比度物体的情况下需要多分辨率分析
- 局部直方图变化， 使得难以为整幅图像构建统一的统计模型

使用图像金字塔

![image-20250324110051029](assets/数字图像处理——频域滤波.assets/image-20250324110051029.png)

### 一维小波变换

#### 连续小波变换（CWT）

给定函数$\psi$（假设它是有限的，且直流分量为0），对其进行缩放和平移
$$
W(s, \tau) = \int_{-\infty}^{\infty} f(x) \frac{1}{\sqrt{s}} \psi\left(\frac{x-\tau}{s}\right) dx
$$

- **参数**：
  - 尺度因子 $ s $：控制小波宽度（大尺度→低频，小尺度→高频）。
  - 平移因子 $ \tau $：控制小波位置。

物理意义

- 小波系数 $ W(s, \tau) $ 反映信号与不同尺度/位置小波的相关性。

小波分析与傅里叶分析对比：

- 傅立叶分析一样，小波分析就是把一个信号分解为将母小波经过缩放和平移之后的一系列小波故小波是小波变换的基函数。小波变换可以理解为用经过缩放和平移的一系列小波函数代替傅立叶变换的正弦波和余弦波进行傅立叶变换的结果

- 正弦波和小波的区别在于，正弦波从负无穷一直延续到正无穷，是平滑且可预测的；而小波是一类在**有限区间内快速衰减到0的函数，其平均值为0，小波趋于不规则、不对称**

  ![image-20250612000340946](assets/数字图像处理——频域滤波.assets/image-20250612000340946.png)

- 从小波和正弦波的形状可以看出，变化剧烈的信号，用不规则的小波进行分析比用平滑的正弦波更好，即用小波更能描述信号的局部特征

小波分析：

- 在小波分析中，近似值是大的缩放因子计算的系数，表示信号的低频分量，而细节值是小的缩放因子计算的系数，表示信号的高频分量
- 小波的缩放因子与信号频率之间的关系是：缩放因子scale越小，表示小波越窄，度量的是信号的细节变化，表示信号频率越高；缩放因子scale越大， 表示小波越宽，度量的是信号的粗糙程度，表示信号频率越低

#### 离散小波变换（DWT）

多分辨率分析（MRA）

- 分解过程：
  - 近似分量（低频）：低通滤波 + 下采样。
  - 细节分量（高频）：高通滤波 + 下采样。

### 二维小波变换

基函数

- 由一维小波张量积生成：
  - 水平方向：$ \psi^H(x, y) = \phi(x)\psi(y) $
  - 垂直方向：$ \psi^V(x, y) = \psi(x)\phi(y) $
  - 对角方向：$ \psi^D(x, y) = \psi(x)\psi(y) $

优势

- 边缘保留：高频细节分量定位边缘。
- 多尺度分析：不同分辨率下的特征提取（如纹理、形状）。

# Lec 5 频域滤波（二）

## 频率域滤波基础*

### 频率与空间

- 频率分量代表什么？
  - 低频
    - 缓慢变化的强度分量
    - 直流分量
  - 高频
    - 强度的急剧变化
    - 边缘和噪声
- 图像如何通过频率域获得增强？

### 频域滤波的步骤

预处理：先图像中心化，具体通过在计算前用$(-1)^{x+y}$乘以输入图像完成

1. 对图像傅里叶变换
   $$
      \mathcal{F}[f(x, y)] = F(u, v)

   $$

   对于$M\times N$的图像，先将其填充至$2M\times 2N$

   > 有无padding填充

2. 进行变换
   $$
      H(u, v) F(u, v)

   $$

   滤波器函数$H(u,v)$的中心在$(M\times N)$

3. 逆变换得到图像
   $$
   \mathcal{F}^{-1}[H(u, v) F(u, v)]
   $$

   裁剪回$M\times N$

   > 有无cropping裁剪

4. 图像为实函数
   $$
   g(x, y) = \text{real}\{\mathcal{F}^{-1}[H(u, v) F(u, v)]\}
   $$

这里给出一个完整的频域滤波的例子

![image-20250610000339602](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec1_7.assets/image-20250610000339602.png)

下面介绍一下滤波过程中常出现的问题：

- 空间卷积：会产生**混淆伪影**

  ![image-20250402225629499](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec1_7.assets/image-20250402225629499.png)

  是由于信号采样频率不足导致的图像扭曲现象，本质是**奈奎斯特采样定理被违反**的结果

- 频率域滤波振铃效应：

  经过完整的四个频域滤波的步骤

  ![image-20250402230123680](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec1_7.assets/image-20250402230123680.png)

  使用理想低通滤波器（如矩形窗）时，高频分量被完全截断，其傅里叶逆变换（sinc函数）在空间域产生周期性震荡，导致边缘处出现波纹

  数学本质：违反吉布斯现象原理，有限项傅里叶级数逼近不连续信号时，会在跳变点附近产生9%的过冲震荡

### 空间域和频率域滤波对应关系

卷积定理是两者唯一的纽带

已知 $H(u, v)$ 时，假设我们想要求其空间域中的等效核。若令 $f(x, y) = \delta(x, y)$，则有：

$$

F(u, v) = 1
$$

滤波后的输出为 $\mathscr{F}^{-1}\{H(u, v)\}$。由此，两个滤波器形成了一个傅里叶变换对：

$$

h(x, y) \Leftrightarrow H(u, v)
$$

式中，$h(x, y)$ 是空间核，可由一个频率域滤波器对一个冲激的响应得到。因此，称 $h(x, y)$ 为 $H(u, v)$ 的冲激响应。

## 频率域滤波器*

- 理想滤波器：希望无衰减通过

  ![image-20250402234636094](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec1_7.assets/image-20250402234636094.png)

  高频分量被完全截断，频域中滤波器越窄，模糊和振铃效应越严重

  于是我们希望既可以平滑图像同时不产生振铃效应：让频域中理想低通滤波器的下降沿更加平滑：于是有了下面两种滤波器

- 巴特沃斯滤波器
  $$
  H(u, v) = \frac{1}{1 + \left[\frac{D(u, v)}{D_0}\right]^{2n}}
  $$
  ![image-20250403000205341](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec1_7.assets/image-20250403000205341.png)

  随着滤波器阶数增加，振铃效应加重

  严格控制截止频率附近低频和高频之间的过渡

- 高斯滤波器
  $$
  H(u, v) = e^{-D^2(u,v)/2D_0^2}
  $$
  高斯函数的数学性质

  - 高斯函数的导数仍是一个高斯函数
  - 高斯函数的傅里叶变换仍是高斯函数

  能够**完全去除振铃效应**

- 拉普拉斯——高通滤波器：图像锐化

- 同态滤波：一种**频域图像增强技术**，专门用于处理因光照不均导致低动态范围的图像（如背光场景、医学影像）。其核心思想是将图像的**照射分量**（illumination）和**反射分量**（reflectance）分离处理，通过压缩动态范围同时增强细节

  基于照射-反射模型的图像表示：

  $$
  f(x, y) = i(x, y) \cdot r(x, y)
  $$

    > i代表随空间位置不同的光强（Illumination）分量，其特点是缓慢变化，集中在图像的低频部分。
    > r代表景物反射到人眼的反射（Reflectance）分量，其特点包含了景物各种信息，高频成分丰富。

  同态滤波通过**对数变换 + 频域滤波**分离并独立处理分量，即对非线性（乘性）混杂信号，通过某种数学运算（如对数变换），变成加性模型，而后采用线性滤波方法进行处理

- 选择性滤波

  - 带阻滤波器

  - 带通滤波器

  - 陷波滤波器：阻止（或通过）事先定义的频率矩形邻域中的频率。

    可由多个带阻滤波器相乘产生，其数学本质是带阻滤波器（Band-Stop Filter）的特例，但具有更精确的频率选择性
