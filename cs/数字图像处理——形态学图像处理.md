# Lec 9 形态学图像处理

形态学是生物学的一个分支，它主要研究动植物的形态和结构



## 预备知识（集合论）*

数学形态学（Mathematical Morphology）

- 基本思想：用具有一定形态的**结构元素**（Structuring Element, SE）去提取图像中的**对应形状**，以达到对图像分析和识别的目的
- 特点：简化图像数据，保持它们基本的形状特性，并除去不相干结构
- 应用领域：使用数学形态学的算法可进行图像形状和结构的分析处理，包括图像分割、特征抽取、边界检测、图像滤波、图像增强和恢复等多种图像处理任务
- 结构元素(SE)：结构元素作为“探针”在图像中移动，探测和分析图像结构。这种方法可以基于图像的形态、大小等信息来探测、研究图像的结构特征。
- 基本运算：膨胀、腐蚀、开运算和闭运算
- 数学基础和所用语言：集合论

基本符号和术语

1. 元素和集合

2. 交集、并集和补集

3. 击中（Hit）与击不中（Miss）

   设有两幅图像 $  A  $ 和 $  B  $，如果 $  A \cap B \neq \emptyset  $，那么称 $  B  $ 击中 $  A  $，记为 $  B \uparrow A  $
   否则，如果 $  A \cap B = \emptyset  $，那么称 $  B  $ 击不中 $  A  $

4. 平移和反射

   设 $  A  $ 是一副数字图像，$  b  $ 是一个点，则定义 $  A  $ 被 $  b  $ 平移后的结果为$$(A)_b = \{a + b \mid a \in A\}$$

   集合 $  A  $ 相对于其原点的反射（表示 $ \hat{A} $）定义为$$\hat{A} = \{w \mid w = -a, a \in A\}$$

5. 目标和结构元素

   - 目标集合：定义为前景像素的集合

     > **前景像素（Foreground Pixels）** 是指图像中代表目标物体或感兴趣区域的像素

   - 结构元素（SE）：形态学中的**基本元素**，是为了探测图像的某种结构信息而设计的特定性质和尺寸的图像，称为收集图像结构信息的探针。

     > 结构元可以指定一个原点，它是结构元素参与形态学运算的参考点
     >
     > 原点可以包含在结构元中，也可以不包含在结构元中，但运算结果常不相同

| 运算 | 公式                                                    | 注释                                      |
| ---- | ------------------------------------------------------- | ----------------------------------------- |
| 平移 | $ (B)_z = \{c \mid c = b + z, b \in B\} $               | 将 $  B  $ 的原点平移到点 $  z  $         |
| 反射 | $ \hat{B} = \{w \mid w = -b, b \in B\} $                | 相对于 $  B  $ 的原点反射                 |
| 补集 | $ A^c = \{w \mid w \notin A\} $                         | 不属于 $  A  $ 的点集                     |
| 差集 | $ A - B = \{w \mid w \in A, w \notin B\} = A \cap B^c $ | 属于 $  A  $ 但不属于 $  B  $ 的点集 运算 |

## 二值形态学基本运算*

二值形态学（Binary Morphology）

设A为图像集合，B为结构元，数学形态学运算是用B对A进行操作

二值形态学的两个最基本运算：腐蚀和膨胀

- 膨胀：增长或粗化二值图像中的目标

  与结构元素比较，中心点重合（只看1）则周围变为1

- 腐蚀：一种收缩或细化的运算，消除物体边界点，使边界向内部收缩，可以把小于结构元素的物体去除

  找出所有严丝合缝，只留下中心点，其它全变为0

> Tips：膨胀和腐蚀：并不互为逆运算，腐蚀和膨胀相对于补集和反射，彼此对偶

- 开运算：先腐蚀再膨胀，恒使原图像缩小

- 闭运算：先膨胀再腐蚀，恒使原图像扩大

  > 一次滤波就能把所有特定结构元的噪声滤除干净，重复运算不会再有效果

- 开闭运算的代数性质：

  - 对偶性

  - 扩展性（收缩性）

  - 单调性

  - 等幂性：一次滤波就能把所有特定结构元的噪声滤除干净，重复运算不会再有效果

- 击中-击不中变换（Hit-or-Miss Transform, HMT）

  一个物体的结构可以由物体内部各种成分之间的关系来确定。为了研究图像的结构，可以逐个利用各种结构元对其进行检验，判定哪些成分包括在图像（目标）内，哪些在图像（目标）外

  - 击中运算相当于一种条件比较严格的模板匹配：不仅指出被匹配点所应满足的性质（即模板的形状），同时也指出这些点所不应满足的性质
  - 击中-击不中变换可以用于保持拓扑结构的形状，以及形状识别和定位
  - 为什么需要两个结构元素：既要处理前景像素，又要处理背景像素

形态学运算及其性质小结（A-二值图像$I$的前景像素集合；B-结构元；注释里罗马数字是上述结构元）

![image-20250610114125679](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250610114125679.png)

## 形态学滤波算法与应用*

- 形态学滤波（去噪）

  - 开运算处理图像凸出部分，闭运算处理凹入部分

  - 开闭运算均为单边滤波器，用于去除噪声或恢复图像

  - 结合使用开、闭运算，构成形态学噪声滤波器，如 𝐀○𝑩 ●𝐁或 𝐀●𝑩 ○𝐁

  - 交替使用开闭运算可以实现双边滤波效果

- 孔洞填充Hole Filling

  - 孔洞是被前景像素连成的边框所包围的背景区域

  - 算法流程（已知孔洞的一个点，用前景像素膨胀，逐步填充所有孔洞）

    ![image-20250430144810159](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250430144810159.png)

- 凸壳Convex Hull

  目标：得到二值图像 $I$ 中嵌入前景像素集合 $A$ 的凸壳的近似

  算法流程：反复使用多个特定结构元素对图像做**击中-击不中变换**，分别收敛后合并

  $$
  X_k^i = (X_{k-1}^i \odot B^i) \cup X_{k-1}^i
  $$
  上述凸壳算法缺点：凸壳会增长到超出保证凸性所需的最小尺寸

  > 减少这种生长的方法：设定限制凸壳不超过集合A的垂直和水平尺寸

  改善凸壳算法：增加其他方向（如对角线方向/8方向）结构元

  ![image-20250430145853183](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250430145853183.png)

- 细化Thinning

  结构元 $B$ 对前景像素集合 $A$ 的细化（记为 $A \otimes B$），可以根据击中-击不中变换来定义：

  $$
  A \otimes B = A - (A \odot B) = A \cap (A \odot B)^c
  $$
  ![image-20250611194721471](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250611194721471.png)

  细化一副图像A应满足两个条件

  - A应该有规律地减小

  - A逐步缩小的过程中，使A的连通性质保持不变

    ![image-20250611194928467](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250611194928467.png)

- 骨架Skeletons

  骨架是一种描述图像重要拓扑的**细化结构**，广泛用于图像识别和数据压缩

  最大圆盘定义骨架：目标 $A$ 的骨架由 $A$ 内所有最大内切圆盘的圆心组成

  - 最大圆盘不是其他任何完全属于 $A$ 的圆盘的子集，并且至少有两点与目标边界轮廓相切
  - 骨架的每个点都对应一个相应的最大圆盘和半径 $r$

  ![image-20250430150820303](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250430150820303.png)



## 形态学重建

形态学重建（Morphological Reconstruction）

- 形态学重建涉及两幅图像和一个结构元

  - 一幅图像是标记，用 $F$ 标记，包含了重建的起点

  - 另一幅图像是模板，用 $G$ 标记，用来约束重建

  - 结构元用于定义连通性

    由元素都是 $1$ 的 $3 \times 3$ 的结构元

- **测地膨胀和测地腐蚀**都是形态学重建的核心概念

  - 测地膨胀（Geodesic Dilaton）

    标记图像 $F$ 相对于模板图像 $G$ 的大小为 $1$ 的测地膨胀 $D_G^{(1)}(F)$ 定义为
    $$
    D_G^{(1)}(F) = (F \oplus B) \cap G
    $$

    - 交集运算可以保证模板 $G$ 限制标记 $F$ 的生长（膨胀）

    - 测地膨胀和测地腐蚀相对于集合的补集是对偶

    ![image-20250611195707139](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250611195707139.png)

  - 测地腐蚀（Geodesc Erosion）

    标记图像 $F$ 相对于模板图像 $G$ 的大小为 $1$ 的测地腐蚀 $E_G^{(1)}(F)$ 定义为
    $$
    E_G^{(1)}(F) = (F \ominus B) \cup G
    $$

    > 交集运算可以保证图像的测地腐蚀仍然大于等于模板图像

    ![image-20250611195837121](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250611195837121.png)

- 膨胀形态学重建

  定义𝐹相对于𝐺的测地膨胀，迭代𝑘次直至达到稳定状态$R_G^{(k)}(F) = D_G^{k+1}(F)$为止

- 重建开运算Opening by Reconstruction

  重建开运算能够精确地恢复腐蚀后所保留目标的形状

  图像 $  F  $ 的大小为 $  n  $ 的重建开运算定义：$  F  $ 的大小为 $  n  $ 的腐蚀相对于 $  F  $ 的膨胀重建

  $$
  O_R^{(n)}(F) = R_F^D(F \cap nB)
  $$

  - $  F  $ 原图本身被用作模板
  - 重建开运算采用 $  F  $ 的腐蚀结果作为膨胀重建的标记
  - 一般 $  n = 1  $，$$O_R^{(n)}(F) = R_F^D(F \cap B)$$

  ![image-20250611200357147](E:/notes_in_zju/docs/notes/cs/assets/数字图像处理Lec8_12.assets/image-20250611200357147.png)



## 灰度形态学

- 灰度级形态学（Grayscale Morphology）

  灰度级形态学处理对象是灰度图像$f(x,y)$以及结构元$b(x,y)$
