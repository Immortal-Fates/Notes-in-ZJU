# Main Takeaway

浙江大学控制科学与工程学院《智能移动技术》

课程安排

![image-20250219101216354](markdown-img/智能移动技术.assets/image-20250219101216354.png)

考核

![image-20250219101230347](markdown-img/智能移动技术.assets/image-20250219101230347.png)

例程：https://github.com/AtsushiSakai/PythonRobotics.git

<!--more-->

# Lec 1 Intro

- 路径规划：根据所给定的地图和目标位置，规划一条使机器人到达目标位置的路径（只考虑工作空间的几何约束，不考虑机器人的运动学模型和约束）

  > 点路径点，将robot简化为一个点

- 避障规划：根据所得到的实时传感器测量信息，调整路径/轨迹以避免发生碰撞

  > 动态避障

- 轨迹生成：根据机器人的运动学模型和约束，寻找适当的控制命令，将可行路径转化为可行轨迹。

  > 最终可行轨迹



# Lec 2 路径规划

## 路径规划算法

| **维度**     | **位形空间（C-space configuration space）**                  | **工作空间（Workspace）**                               |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------- |
| **数学本质** | 所有可能的机器人**位形（Configuration）**的集合，构成n维流形 | 机器人末端执行器在**物理空间（如XYZ）**中可达的位置集合 |
| **描述对象** | 机器人全体构件的**完整状态**（如所有关节角度）               | 仅关注末端执行器的**位置和朝向**（部分状态）            |
| **示例**     | 平面2R机械臂的C-space是T2=S1×S1（圆环面）                    | 平面2R机械臂的工作空间是平面上的环形区域（可达点集合）  |



- 常见路径规划: 拓扑连通图+最优路径搜索(连续图难以保证时间)

  - 拓扑连通图

    - 基本思路: 对空间离散化

    - 分辨率完备

      解析性离散化，确保获得可行解

      - 行车图法：基于障碍物几何形状分解姿态空间

        基本思想：基于障碍物几何形状分解位形空间，将自由空间的连通性用一维曲线的网格表示，在加入起始点和目标点后，在该一维无向连通图中寻找一条无碰路径

        ![image-20250219143823872](markdown-img/智能移动技术.assets/image-20250219143823872.png)

        - Voronoi diagram

          - 优点
            - 安全性高
          - 缺点
            - 计算复杂、路径长度较可视图法长、不适用于短距离定位传感器

        - 可视图法: 可视图由所有连接可见顶点对的边组成,可见指顶点之间无障碍物,初始位置和目标位置也作为顶点

          - 优点

            - 简单,可得路径长度上的最优解

          - 缺点

            - 所得路径靠近障碍物,不够安全

              > 以远大于机器人半径的尺寸膨胀障碍物，但容易造成可行路径的消失
              >
              > 在路径规划后修改所得路径，使其与障碍物保持一定的距离

      - 单元分解法：区分空闲单元和被占单元

        - 基本思想: 

          首先，将位形空间中的自由空间分为若干的小区域，每一个区域作为一个单元，以单元为顶点、以单元之间的相邻关系为边构成一张连通图；

          其次，在连通图中寻找包含初始姿态和目标姿态的单元，搜索连接初始单元和目标单元的路径；

          最后，根据所得路径的单元序列生成单元内部的路径

        - 精确单元分解: 严格基于环境几何形状分解,所得单元完全空闲

        - 近似单元分解: 栅格表示法，将环境分解成若干个大小相同的栅格

          四叉树表示法

      - 人工势场法：

        - 基本思想: 目标点对机器人产生吸引力,障碍物产生排斥力所有力合成构成机器人的控制率

          对势场求偏导,

        - 缺点: 存在局部最小,容易产生振荡和死锁

    - 概率完备: 基于概率随机采样离散化

      - PRM
      - RRT

## 路径搜索算法

- 广搜
- 深搜
- PRM：非全联通情况
- RRT

分辨率完备与概率完备方法比较 

- 空间离散采样：
  - 分辨率完备是基于解析计算的姿态空间分解
    - **原理**：通过数学解析对机器人的姿态空间进行系统性分解（类似将空间划分为网格）。
  - 概率完备是基于随机采样生成连通图或者树
- 位形空间连通性表示：
  - 分辨率完备完全表达了自由空间的连通性，高维情况下计算负担重
  - 概率完备方法是近似表达了连通性，但计算快速，只需要计算单个机器人姿态是否存在碰撞，其效率与碰撞检测模块效率相关



# Lec 3 避障规划

根据所得到的实时传感器测量信息，规划/调整路径/轨迹，以避免发生碰撞，也称为反应式避障



## Bug算法

- 基本思想：让机器人朝着目标前进，当行进路径上出现障碍物时，机器人绕着障碍物的轮廓移动，然后绕离它，继续驶向目标

| **算法**        | **关键改进**                                                 | **适用场景**                 |
| --------------- | ------------------------------------------------------------ | ---------------------------- |
| **BUG0**        | 基础版本，遇障即绕行，无优化策略。                           | 简单环境，快速实现           |
| **BUG1**        | 绕障时遍历整个障碍物，记录离目标最近的点，最终沿最短路径离开。 | 保证找到路径，但路径较长     |
| **BUG2**        | 沿m-line移动，绕行至再次与m-line相交时离开，减少绕行距离。   | 障碍物稀疏时效率更高         |
| **Tangent Bug** | 利用距离传感器预判障碍物轮廓，选择最优切点绕行，路径更平滑。 | 动态环境，支持实时传感器反馈 |

- BUG1 绕障时遍历整个障碍物，记录离目标最近的点（离开点），最终沿最短路径离开。绕行距离$L\leq d+\frac{3}{2}\sum p_i$

  > 如果离开点到目标的直线与当前障碍物相交，则不存在到达目标的路径

  优点：简单，可确保到达任何可达目标

  缺点：效率低

- BUG2 根据起始点和终止点定义路径L，机器人沿着L行走，当遇到障碍物时，机器人进入障碍物轮廓跟踪模式，当到达L上一个接近目标点的位置时，**如果该位置比碰到障碍物的位置更接近目标点**，则继续沿着L移向目标点，否则继续绕行

  如果机器人在跟踪模式下再次到达进入障碍物轮廓跟踪模式的点，则可以判断不存在到达目标点的路径

  优点：具有较短的移动路径

  缺点：采用贪婪搜索策略，某些请款修改移动低效

  



## 人工势场法



## 向量势直方图法

VFH

- 针对问题：势场法容易陷入局部最优，导致存在振荡、难以通过窄通道
- 基本思想：考虑到势场法仅用推斥势来表示障碍物，从而丢失了局部障碍物分布的详细信息，提出根据环境详细栅格地图构建机器人坐标系下障碍物**概率直方图**，根据概率直方图评估选择最优运动方向



| **优点**                     | **缺点**                               |
| ---------------------------- | -------------------------------------- |
| 实时性强，适合动态环境       | 路径可能非最优，尤其在复杂障碍群中     |
| 计算量低，适合嵌入式系统     | 依赖传感器精度，噪声数据易导致方向误判 |
| 无需全局地图，仅依赖局部感知 | 狭窄通道或密集障碍时可能无解           |

- 实现步骤

  1. 构建并维护机器人周围环境的局部栅格地图

     ![image-20250226215913245](markdown-img/智能移动技术.assets/image-20250226215913245.png)

  2. 为每个栅格计算其障碍物向量，距离机器人越近向量越大

     ![image-20250226220146103](markdown-img/智能移动技术.assets/image-20250226220146103.png)

  3. 转换为极坐标下的障碍物概率直方图

     ![image-20250226220212090](markdown-img/智能移动技术.assets/image-20250226220212090.png)

  4. 根据直方图，识别所有可以让机器人通过的通道，然后对每个通道计算成本，选择具有最低成本的通道，得到导航方向

     ![image-20250226220617209](markdown-img/智能移动技术.assets/image-20250226220617209.png)

| **优点**                     | **缺点**                               |
| ---------------------------- | -------------------------------------- |
| 实时性强，适合动态环境       | 路径可能非最优，尤其在复杂障碍群中     |
| 计算量低，适合嵌入式系统     | 依赖传感器精度，噪声数据易导致方向误判 |
| 无需全局地图，仅依赖局部感知 | 狭窄通道或密集障碍时可能无解           |

## 动态窗口法

DWA dynamic window algorithm

- 基本思想：在速度空间中搜索适当的平移速度和旋转速度指令$(v，w)$

  从几何空间搜索转化为速度空间搜索

- 实现步骤

  1. 基于速度控制运动模型，构建可行的速度空间

  2. 考虑到机器人在运动过程中最大加速度的约束，在当前速度配置处以固定的小时间间隔开一个速度窗口空间

     ![image-20250226222101219](markdown-img/智能移动技术.assets/image-20250226222101219.png)

  3. 结合机器人速度约束，获得可行速度空间

     ![image-20250226222126006](markdown-img/智能移动技术.assets/image-20250226222126006.png)

  4. 在可行速度空间中选择最优的速度控制指令

     ![image-20250226222328224](markdown-img/智能移动技术.assets/image-20250226222328224.png)

缺点：

- 根据单步信息数据计算期望速度，在评估选择速度时不考虑速度和路径平滑，容易导致机器人运动存在震动和轨迹扭动问题
- 参数较多，实际实现依赖工程经验，难以适应各种情况

| **算法**   | **DWA**              | **VFH**                | **TEB**              |
| ---------- | -------------------- | ---------------------- | -------------------- |
| **核心**   | 速度采样+轨迹评价    | 障碍密度直方图方向选择 | 时间弹性带优化轨迹   |
| **实时性** | 高（百毫秒级响应）   | 中（需构建直方图）     | 低（非线性优化耗时） |
| **适用性** | 动态障碍、低算力设备 | 狭窄通道、局部避障     | 高精度轨迹跟踪       |



![image-20250226221608049](markdown-img/智能移动技术.assets/image-20250226221608049.png)





# Lec 4 轨迹规划

目标：给定路径与约束，生成一组控制序列，使机器人从初始位姿移动到目标位姿

![image-20250226223030821](markdown-img/智能移动技术.assets/image-20250226223030821.png)

根据约束和最优目标，求取函数参数。需考虑的约束：

- 路径约束
- 运动学约束
- 边界约束
- 连续性/光滑性要求

## 一维轨迹规划

- 多项式
- 三角函数
- 指数函数



复合一维轨迹规划

- 多个基本一维轨迹合成
- 可降低多项式阶次
- 可满足机器人执行能力的约束
- 可利用最大化速度或加速度等来实现时间最优

常用复合轨迹（具体计算和运用看PPT）

- 抛物线轨迹：2个二阶多项式合成　加速度恒定，可满足初末位置和初末速度约束

- 梯形速度轨迹：2个二阶多项式和1个一阶多项式合成

  ![image-20250226223859856](markdown-img/智能移动技术.assets/image-20250226223859856.png)

- 双S速度轨迹



## 二维轨迹规划

在平面上移动时，机器人有三个状态量 $(x, y, \theta)$

**轨迹规划**：
- 理论上：三维轨迹规划 $(x(t), y(t), \theta(t))$
- 实际上：二维轨迹规划 
  - $(x(t), y(t))$ 或 
  - $(v(t), \omega(t))$（线速度与角速度）

**角度计算**：
$$
\theta(t) = \arctan\left( \frac{\dot{y}(t)}{\dot{x}(t)} \right) = \arctan\left( \frac{y(t+\Delta t) - y(t)}{x(t+\Delta t) - x(t)} \right)
$$

**运动学方程**：
$$
\begin{cases}
\dot{\theta}(t) = \omega(t) \\
\dot{x}(t) = v(t)\cos\theta(t) \\
\dot{y}(t) = v(t)\sin\theta(t)
\end{cases}
$$
$(x(t),y(t))$

- 完整机器人(可全向移动): x,y独立规划,时间同步即可
- 非完整机器人,图形搜索法

$(v(t),w(t))$

- 参数优化法
- 反馈控制法



### 图形搜索法

- 主要思路：根据路径搜索经过或者近似经过路径点且满足运动学约束的图形曲线

  采用运动基元

  缺点：

  - 如何构建单词和搜索最佳单词
  - 运动基元方式实际是对状态空间和/或控制空间进行了离散化，直接导致空间分辨率降低，能达到的边界状态只是预定义单词能够达到的状态

- Dubins曲线[Dubins曲线详细笔记](https://zhuanlan.zhihu.com/p/414753861)

  - 将v约束喂取值$\{0,1\}$

  - 具有最小转弯半径$\rho_{ min}$的前向运动车辆在两个路径点之间的最短路径可以完全由不超过三个的运动基元组成
    运动基元为半径为$\rho_{ min}$向左或者向右转弯的圆弧、或者为直线，分别用L， R,S表示

    ![image-20250228084211558](markdown-img/智能移动技术.assets/image-20250228084211558.png)

  - 选什么单词，下标取什么值？——遍历评估

- REEDS-SHEPP曲线[自动驾驶运动规划-Reeds Shepp曲线](https://zhuanlan.zhihu.com/p/122544884)

  - 比Dubins曲线多了允许向后运动，运动基元有$L,R,S,|$

    可用48个不同的单词来描述最短路径

- Balkcom-Mason曲线



### 参数优化法

- 基本思想：对移动机器人参考点的速度控制率进行参数化表示



- 离散的最优控制，只需要满足起始和末端的状态，$x(t)=x(t-1)+\Delta T\times constraint$，然后丢到求解器求解即可



![image-20250228090625428](markdown-img/智能移动技术.assets/image-20250228090625428.png)

- 实际应用时，通常预先构造初始猜测查找表，或构建神经网络，简历边界约束与控制率参数之间的映射关系



### 反馈控制法

- 基本思想：根据当前状态与目标状态之间的差异，来生成减少这种差异的控制律

- 使用极坐标，建立机器人的运动模型，直接根据状态空间方程来设计控制器即可

- 缺点：
  - 不考虑当前速度，容易造成速度不连续
  - 平移速度、转向速度相互独立，但机器人总能力是有限的，且平移速度和转向速度存在关联















# References

- [DomyRndi/ZJU-ICP-mileage-estimation: 浙江大学控制科学与工程学院《智能移动技术》课程 ICP里程估计作业 (github.com)](https://github.com/DomyRndi/ZJU-ICP-mileage-estimation)
- [jyczju/Robot_Path_Plan: 浙江大学控制学院《智能移动技术》课程大作业 (github.com)](https://github.com/jyczju/Robot_Path_Plan)
- [Suhao07/Intellectual-motion-technology: 智能移动技术课程代码 (github.com)](https://github.com/Suhao07/Intellectual-motion-technology)