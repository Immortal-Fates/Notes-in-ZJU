# 非线性规划

[TOC]



# 非线性规划问题





# 最优性条件





# 对偶理论





# 《优化方法》导论型笔记（加强版，Markdown）

> 面向研一研二复习与开卷自查。按“从建模→无约束→有约束→最优性条件→凸优化”的自然顺序整理，并补充**考试/作业答题模板**与**二阶检查清单**。行内公式均用 $$…$$。

---

## 1) 优化问题的建模与基本概念

- **标准模型**  
  $$\min\ f(x)\ \ \text{s.t.}\ \ g_j(x)\le 0,\ \ h_i(x)=0$$  
  其中 $$x\in\mathbb{R}^n,\ f,g_j,h_i$$ 连续可微（若未说明）。

- **可行域/最优解**  
  可行域 $$\mathcal{X}=\{x\mid g_j(x)\le0,\ h_i(x)=0\}$$；  
  $$x^\*$$ 为全局极小若 $$f(x^\*)\le f(x),\ \forall x\in\mathcal{X}$$；为局部极小若存在邻域 $$\mathcal{N}(x^\*)$$ 使不等式仅在该邻域内成立。

- **上/下确界与最值**  
  记 $$\inf_{\mathcal{X}} f,\ \sup_{\mathcal{X}} f$$；若能被某可行点取到即为 $$\min/\max$$。

- **最优解存在性的直觉**  
  连续目标在“**非空且有界闭**”的可行域上常能取得极小（Weierstrass 思路）；无约束时若 $$f(x)\to +\infty\ ( \|x\|\to\infty )$$（强制/coercive），也常存在极小。

---

## 2) 无约束优化：一/二阶条件

- **一阶必要条件（驻点）**  
  局部极小 $$x^\*$$ 必满足 $$\nabla f(x^\*)=0$$。

- **二阶必要/充分条件**  
  设 Hessian $$\nabla^2 f(x^\*)$$：  
  必要：$$\nabla f(x^\*)=0,\ \nabla^2 f(x^\*)\succeq 0$$；  
  充分：$$\nabla f(x^\*)=0,\ \nabla^2 f(x^\*)\succ 0\Rightarrow x^\*$$ 为严格局部极小。  
  矩阵正定性可用特征值、主子式或 Cholesky 判定。

- **几何直觉**  
  沿任意方向 $$p$$ 的二次近似 $$f(x^\*+p)\approx f(x^\*)+\tfrac12 p^\top \nabla^2 f(x^\*) p$$；正定意味着所有方向上“碗口向上”。

---

## 3) 等式约束：拉格朗日乘子法

- **拉格朗日函数**  
  $$L(x,\nu)=f(x)+\nu^\top h(x)$$。

- **一阶条件**  
  可行点 $$x^\*$$ 若为局部极小，常伴随乘子 $$\nu^\*$$ 使  
  $$\nabla_x L(x^\*,\nu^\*)=0,\ \ h(x^\*)=0$$。  
  物理含义：等式约束的“反作用力”由乘子刻画。

---

## 4) 不等式约束与可行方向

- **活跃约束与可行方向**  
  在边界点，活跃集 $$\mathcal{A}(x)=\{j\mid g_j(x)=0\}$$。  
  向量 $$d$$ 为线性化可行方向需满足  
  $$\nabla h_i(x)^\top d=0,\ \ \nabla g_j(x)^\top d\le 0\ (j\in\mathcal{A}(x))$$。  
  若不存在“可行的下降方向”（使 $$\nabla f(x)^\top d<0$$），则是局部极小的直观必要性。

---

## 5) FJ 与 KKT：一阶最优性条件的统一框架

- **Fritz John（FJ）必要条件**  
  对局部极小 $$x^\*$$，存在不全为零的乘子  
  $$\mu_0\ge 0,\ \mu_j\ge 0,\ \nu_i\in\mathbb{R}$$，使  
  $$\mu_0\nabla f(x^\*)+\sum_j \mu_j \nabla g_j(x^\*)+\sum_i \nu_i \nabla h_i(x^\*)=0,$$  
  $$g_j(x^\*)\le 0,\ \ \mu_j g_j(x^\*)=0,\ \ h_i(x^\*)=0$$。  
  其中 $$\mu_0=0$$ 的“退化”情形提示约束奇异或资格条件不足。

- **Karush–Kuhn–Tucker（KKT）条件**  
  若再满足合适的**约束资格（CQ）**，可令 $$\mu_0=1$$ 归一化，得到  
  $$\nabla f(x^\*)+\sum_j \lambda_j^\* \nabla g_j(x^\*)+\sum_i \nu_i^\* \nabla h_i(x^\*)=0,$$  
  $$g_j(x^\*)\le 0,\ \ \lambda_j^\*\ge 0,\ \ \lambda_j^\* g_j(x^\*)=0,\ \ h_i(x^\*)=0$$。  
  ——这是最常用的一阶**必要条件**（在凸情形下还是**充要条件**，见 §7）。

---

## 6) 约束资格（CQ）：KKT 必要性的保障

- **常见 CQ**  
  - **LICQ**（线性无关）：活跃约束的梯度向量线性无关。  
  - **MFCQ**：存在方向 $$d$$ 使 $$\nabla h_i^\top d=0$$ 且活跃不等式满足 $$\nabla g_j^\top d<0$$。  
  - **Slater 条件**（凸问题）：存在严格可行点 $$g_j(x)<0,\ h_i(x)=0$$。  
- **作用**  
  在相应假设下保证“存在乘子 + $$\mu_0=1$$”，从而 KKT 成为必要条件。  
- **实务建议**  
  建模后先快速检查：线性等式 + 凸不等式 ⇒ 用 Slater；一般非凸 ⇒ 尝试验证 LICQ/MFCQ。

---

## 7) 二阶最优性条件（含约束）

- **临界锥 $$C(x^\*,\lambda^\*,\nu^\*)$$**  
  由线性化可行方向且满足驻点互补关系的“可疑方向”构成，是二阶分析的舞台。

- **二阶必要条件**  
  对任意 $$p\in C(x^\*,\lambda^\*,\nu^\*)$$，有  
  $$p^\top \nabla_{xx}^2 L(x^\*,\lambda^\*,\nu^\*)\, p\ \ge\ 0$$。

- **二阶充分条件**  
  若对所有非零 $$p\in C(x^\*,\lambda^\*,\nu^\*)$$ 有  
  $$p^\top \nabla_{xx}^2 L(x^\*,\lambda^\*,\nu^\*)\, p\ >\ 0$$，  
  则 $$x^\*$$ 为严格局部极小。  
  直觉：在一阶“平衡”后，拉氏 Hessian 在可行“自由度”方向上要“向上弯”。

---

## 8) 凸优化的特例与简化

- **凸函数/凸集**  
  若 $$f$$ 凸、等式约束线性、不等式约束 $$g_j$$ 均凸，则为**凸规划**；可行域是凸集。

- **一阶全局性**  
  凸函数满足  
  $$f(y)\ \ge\ f(x)+\nabla f(x)^\top (y-x)$$；  
  因此若存在 $$x^\*$$ 使 $$0\in \nabla f(x^\*)+\mathcal{N}_\mathcal{X}(x^\*)$$（KKT 的几何形态），即为**全局极小**。

- **KKT 的充要性（在 Slater 下）**  
  凸规划 + Slater ⇒ KKT **必要且充分**；验证 KKT 便等价于验证全局最优。

- **二次规划（QP）与正定性**  
  $$f(x)=\tfrac12 x^\top Qx+c^\top x$$，若 $$Q\succeq 0$$ 则目标凸；配合线性约束得到经典 QP。

---

## 9) 解题套路与检查清单（速用）

1. **建模**：明确变量、目标与约束；判断是否凸。  
2. **可行性/存在性**：检查可行域是否非空；强制性或边界闭性。  
3. **无约束 or 等式化**：能否消去等式或用拉格朗日法处理。  
4. **一阶条件**：写出 KKT（或先 FJ）；记录活跃集与互补松弛 $$\lambda_j g_j=0$$。  
5. **资格条件**：在非凸情形验证 LICQ/MFCQ；凸情形考虑 Slater。  
6. **二阶判定**：无约束看 Hessian；有约束在临界锥上检查拉氏 Hessian。  
7. **凸特例**：若为凸并满足 Slater，KKT 即充要，可直接给出全局最优性结论。  
8. **数值实现提示**：  
   - 无约束：梯度/牛顿、线搜索或信赖域；  
   - 有约束：投影梯度、序列二次规划（SQP）、障碍/惩罚与内点法；  
   - 乘子估计与活跃集管理常与 KKT 残差一并收敛监控。

---

## 10) 常见易错点与经验法则

- **把 KKT 当“普适必要”**：非也；缺少 CQ 可能只得到 FJ（出现 $$\mu_0=0$$ 的退化）。  
- **二阶条件范围**：有约束时绝不是“任意方向”检查，而是**临界锥方向**。  
- **“找到驻点=最优”**：非凸问题驻点可能是鞍点；需二阶或其他判定。  
- **忽视尺度/强制性**：无界可行域易导致无最小值；加正则或检查强制性。  
- **忽略互补松弛**：写 KKT 时务必带上 $$\lambda_j\ge0,\ \lambda_j g_j=0$$ 两条。

---

## 11) 速查公式块（便携版）

- **无约束**：$$\nabla f(x^\*)=0;\ \ \nabla^2 f(x^\*)\succeq 0\ (\text{必要}),\ \ \succ 0\ (\text{充分})$$  
- **KKT**：  
  $$\nabla f(x^\*)+\sum_j\lambda_j^\*\nabla g_j(x^\*)+\sum_i\nu_i^\*\nabla h_i(x^\*)=0$$  
  $$g_j(x^\*)\le0,\ \lambda_j^\*\ge0,\ \lambda_j^\*g_j(x^\*)=0,\ \ h_i(x^\*)=0$$  
- **二阶（有约束）**：对 $$p\in C(x^\*,\lambda^\*,\nu^\*)$$，  
  $$p^\top \nabla_{xx}^2 L(x^\*,\lambda^\*,\nu^\*)\, p\ \ge\ 0\ (\text{必要}),\ >0\ (\text{充分})$$  
- **凸优化充要性**（Slater 下）：  
  $$\text{KKT} \iff \text{全局最优}$$

---

## 12) 考试/作业答题模板（可直接套用）

> 模板 1：一般非线性规划（NLP）——从建模到 KKT

**(a) 建模与判断**  

- 变量：写出 $$x\in\mathbb{R}^n$$；目标 $$f(x)$$；不等式 $$g_j(x)\le 0$$；等式 $$h_i(x)=0$$。  
- 凸性判断（若需）：给出 $$\nabla^2 f,\ \nabla^2 g_j$$ 的半正定性或反例。

**(b) 拉格朗日函数**  
$$L(x,\lambda,\nu)=f(x)+\sum_j\lambda_j g_j(x)+\sum_i\nu_i h_i(x)$$。

**(c) KKT 条件（写满四类）**  

- 驻点：$$\nabla_x L(x,\lambda,\nu)=0$$  
- 原可行：$$g_j(x)\le 0,\ \ h_i(x)=0$$  
- 互补：$$\lambda_j g_j(x)=0$$  
- 对偶可行：$$\lambda_j\ge 0$$

**(d) 活跃集与情形划分**  

- 设活跃集 $$\mathcal{A}=\{j\mid g_j(x)=0\}$$；对不同活跃组合求解线性/非线性方程组，筛选可行解。

**(e) 二阶验证（必要/充分）**  

- 构造临界锥 $$C(x,\lambda,\nu)$$；检查 $$p^\top \nabla_{xx}^2 L\,p\ge 0$$（必要）或 $$>0$$（充分）。

**(f) 结论**  

- 给出候选点的最优性与值：$$f(x^\*)$$，并说明是否全局（凸/非凸理由）。


> 模板 2：等式约束最小化（无不等式）

- $$L(x,\nu)=f(x)+\nu^\top h(x)$$；  
- 条件：$$\nabla f(x)+\nabla h(x)\nu=0,\ \ h(x)=0$$；  
- 若 Jacobian $$\nabla h(x)$$ 满秩（LICQ），使用隐函数或 KKT 必要性；  
- 二阶：在 $$\{p\mid \nabla h(x)^\top p=0\}$$ 上检查 $$p^\top \nabla^2 L\,p$$。


> 模板 3：仅有不等式约束的问题

- $$L(x,\lambda)=f(x)+\sum_j\lambda_j g_j(x)$$；  
- KKT 四件套同上；  
- 一般先猜活跃集作代入，再解驻点方程并回代互补条件。


> 模板 4：二次规划（QP）快速写法

- $$f(x)=\tfrac12 x^\top Qx+c^\top x,\ \ Q\succeq 0$$（凸情形）；  
- 线性约束 $$Ax\le b,\ Cx=d$$；  
- KKT：  
  $$Qx+c+A^\top \lambda + C^\top \nu=0,\ \ Ax\le b,\ Cx=d,\ \ \lambda\ge 0,\ \ \lambda\odot (Ax-b)=0$$；  
- 若仅等式约束且 $$Q\succ 0$$，解线性方程组  
  $$\begin{bmatrix}Q & C^\top\\ C & 0\end{bmatrix}\begin{bmatrix}x\\ \nu\end{bmatrix}=\begin{bmatrix}-c\\ d\end{bmatrix}$$。


> 模板 5：凸规划判定与最优性说明

- 证明 $$f,\ g_j$$ 凸，$$h_i$$ 线性；  
- 给出一个满足 $$g_j(x)<0,\ h_i(x)=0$$ 的严格可行点（Slater）；  
- 写出 KKT 并求解；  
- 结论：KKT 成立 ⇒ 全局最优。

---

## 13) 二阶检查步骤清单（可粘贴）

1. **确定候选点**：由 KKT/驻点得到 $$x^\*,\ (\lambda^\*,\nu^\*)$$。  
2. **线性化与临界锥**：  
   $$C=\{p\mid \nabla h(x^\*)^\top p=0,\ \ \nabla g_\mathcal{A}(x^\*)^\top p\le 0,\ \ \lambda_\mathcal{A}^\*\odot(\nabla g_\mathcal{A}^\top p)=0\}$$。  
3. **拉氏 Hessian**：计算 $$H_L=\nabla_{xx}^2 f(x^\*)+\sum_{j\in\mathcal{A}}\lambda_j^\*\nabla_{xx}^2 g_j(x^\*)+\sum_i\nu_i^\*\nabla_{xx}^2 h_i(x^\*)$$。  
4. **必要性测试**：验证 $$p^\top H_L p\ge 0,\ \forall p\in C$$。  
5. **充分性测试**：若 $$p^\top H_L p>0,\ \forall p\in C\setminus\{0\}$$ ⇒ 严格局部极小。  
6. **数值替代**（工程写法）：在可行子空间上对 $$H_L$$ 做投影或采用 Schur/QR 得到等价正定性判据。

---

## 14) 常见结构化问题的快速判定

- **LASSO/带 $$\ell_1$$ 正则**：目标 $$\|Ax-b\|_2^2+\alpha\|x\|_1$$ 凸（但不可微）；用次梯度 KKT 或软阈值法。  
- **逻辑回归**：负对数似然凸；加 $$\ell_2$$ 正则仍凸；无等式约束时 KKT=一阶站立性（梯度为零或落在子微分里）。  
- **谱范数/核范数**：凸但需半正定矩阵锥；使用锥规划 KKT。

---

## 15) 数值算法速览（答题关键词）

- **梯度法 (GD)**：下降方向 $$- \nabla f$$，线搜索（Armijo/Wolfe）。  
- **牛顿/拟牛顿 (Newton/BFGS)**：二阶近似；BFGS 保持正定近似。  
- **信赖域 (TR)**：在半径内解子问题；Cauchy 点/狗腿法。  
- **投影梯度 (PGD)**：$$x^{k+1}=\Pi_{\mathcal{X}}(x^k-\alpha\nabla f(x^k))$$。  
- **惩罚/增广拉格朗日**：把约束并入目标；ALM 可视作对偶方法。  
- **障碍/内点 (IPM)**：$$\min f(x)-\mu\sum_j\log(-g_j(x))$$，沿中心路径减小 $$\mu$$。  
- **SQP**：逐步解 QP 近似的一阶/二阶 KKT。

---

## 16) 典型例题骨架（留白可直接手写）

**例 1：非线性不等式 + 等式**  

- 目标/约束：……  
- $$L(x,\lambda,\nu)=\cdots$$  
- **KKT**：  
  $$\nabla_x L=0;\ \ g\le 0,\ h=0;\ \ \lambda\ge 0;\ \ \lambda\odot g=0$$  
- **活跃集假设**：写出集合并解未知量  
- **二阶检查**：构造 $$C$$ 与 $$H_L$$，判定必要/充分  
- **结论**：最优点/值与全局性说明

**例 2：凸 QP（线性约束）**  

- $$\min\ \tfrac12 x^\top Qx+c^\top x\ \ \text{s.t.}\ Ax\le b,\ Cx=d$$  
- **KKT 线性系统/互补** 写出；若仅等式 ⇒ 直接解块线性系统  
- **凸性与 Slater**：给出严格可行点并下结论“全局最优”

---

## A) KKT 推导空白框（打印后可手写）

- **已知**：$$f(x),\ g(x),\ h(x)$$  
- **构造**：$$L(x,\lambda,\nu)=f+\lambda^\top g+\nu^\top h$$  
- **写出**：  
  1) $$\nabla_x L=0$$  
  2) $$g\le 0,\ h=0$$  
  3) $$\lambda\ge 0$$  
  4) $$\lambda\odot g=0$$  
- **解得候选**：$$x^\*,\ \lambda^\*,\ \nu^\*$$  
- **二阶（可选）**：在 $$C$$ 上检验 $$p^\top \nabla_{xx}^2 L\,p(\ge/> )0$$  
- **最优性结论**：______（凸/非凸、局部/全局）

---

## B) 二阶检查速填表

| 项目                 | 表达式                                                       | 是否满足      |
| -------------------- | ------------------------------------------------------------ | ------------- |
| 临界锥 $$C$$ 约束    | $$\nabla h^\top p=0,\ \nabla g_\mathcal{A}^\top p\le0,\ \lambda_\mathcal{A}\odot(\nabla g_\mathcal{A}^\top p)=0$$ | □是 □否       |
| 拉氏 Hessian $$H_L$$ | $$\nabla_{xx}^2 f+\sum \lambda_j\nabla_{xx}^2 g_j+\sum \nu_i\nabla_{xx}^2 h_i$$ | —             |
| 必要判定             | $$p^\top H_L p\ge0,\ \forall p\in C$$                        | □成立 □不成立 |
| 充分判定             | $$p^\top H_L p>0,\ \forall p\in C\setminus\{0\}$$            | □成立 □不成立 |

---

### 使用建议

- 考试遇到证明题：优先判断凸性与 Slater；若成立则直接以 **KKT 充要性** 收尾。  
- 非凸计算题：写满 KKT 四件套 + 活跃集枚举，最后做**局部二阶**检查。

