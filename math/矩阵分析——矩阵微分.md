# Main Takeaway

这节介绍《矩阵分析与应用》张显达——第三章，矩阵微分



<!--more-->

# 矩阵微分

## Jacobian矩阵与梯度矩阵

- $  1 \times m  $ 行向量偏导算子记为
  $$
  D_x \stackrel{\text{def}}{=} \frac{\partial}{\partial x^T} = \begin{bmatrix}\frac{\partial}{\partial x_1}, \cdots, \frac{\partial}{\partial x_m}\end{bmatrix}
  $$
  于是，实值标量函数 $  f(x)  $ 在 $  x  $ 的偏导向量由 $  1 \times m  $ 行向量

  $$D_x f(x) = \frac{\partial f(x)}{\partial x^T} = \begin{bmatrix}\frac{\partial f(x)}{\partial x_1}, \cdots, \frac{\partial f(x)}{\partial x_m}\end{bmatrix}$$给出。

- 当实值标量函数 $  f(X)  $ 的变元为实值矩阵 $  X \in \mathbb{R}^{m \times n}  $ 时，存在两种可能的定义

  1. $$
     D_X f(X) = \frac{\partial f(X)}{\partial X^T} = \begin{bmatrix}\frac{\partial f(X)}{\partial x_{11}} & \cdots & \frac{\partial f(X)}{\partial x_{m1}} \\\vdots & \ddots & \vdots \\\frac{\partial f(X)}{\partial x_{1n}} & \cdots & \frac{\partial f(X)}{\partial x_{mn}}\end{bmatrix} \in \mathbb{R}^{n \times m}
     $$

  2. $$
     D_{\text{vec}X} f(X) = \frac{\partial f(X)}{\partial \text{vec}^T(X)} = \begin{bmatrix}\frac{\partial f(X)}{\partial x_{11}}, \cdots, \frac{\partial f(X)}{\partial x_{m1}}, \cdots, \frac{\partial f(X)}{\partial x_{1n}}, \cdots, \frac{\partial f(X)}{\partial x_{mn}}\end{bmatrix}
     $$

  其中 $  D_X f(X)  $ 和 $  D_{\text{vec}X} f(X)  $ 分别称为实值标量函数 $  f(X)  $ 关于矩阵变元 $  X  $ 的 Jacobian 矩阵和行偏导向量，两者之间的关系为$$D_{\text{vec}X} f(X) = \text{rvec}(D_X f(X)) = \left( \text{vec}(D_X^T f(X)) \right)^T$$

  即实值标量函数 $  f(X)  $ 的行向量偏导 $  D_{\text{vec}X} f(X)  $ 等于 Jacobian 矩阵的转置 $  D_X^T f(X)  $ 的列向量化 $  \text{vec}(D_X^T f(X))  $ 的转置。这一重要关系是 Jacobian 矩阵辨识的基础。

  事实上，在实际应用中 Jacobian 矩阵比行偏导向量更有用。

- 现在考虑实值矩阵函数 $  F(X) = [f_{kl}]_{k=1,l=1}^{p,q} \in \mathbb{R}^{p \times q}  $ 的情况，其中，矩阵变元 $  X \in \mathbb{R}^{m \times n}  $。此时，有多种可能的行偏导矩阵定义。下面给出一种较好的定义：

  先通过列向量化，将 $  p \times q  $ 矩阵函数 $  F(X)  $ 转换成 $  pq \times 1  $ 列向量

  $$
  \text{vec}(F(X)) \stackrel{\text{def}}{=} [f_{11}(X), \cdots, f_{p1}(X), \cdots, f_{1q}(X), \cdots, f_{pq}(X)]^T \in \mathbb{R}^{pq}
  $$
  然后，该列向量对矩阵变元 $  X  $ 的列向量化的转置 $  (\text{vec}X)^T  $ 求偏导，给出 $  pq \times mn  $ 维
  Jacobian 矩阵
  $$
  D_X F(X) \stackrel{\text{def}}{=} \frac{\partial \text{vec}(F(X))}{\partial (\text{vec}X)^T} \in \mathbb{R}^{pq \times mn}
  $$
  其具体表达式为

  $$
  D_X F(X) = \begin{bmatrix}\frac{\partial f_{11}}{\partial (\text{vec}X)^T} \\\frac{\partial f_{p1}}{\partial (\text{vec}X)^T} \\\vdots \\\frac{\partial f_{1q}}{\partial (\text{vec}X)^T} \\\frac{\partial f_{pq}}{\partial (\text{vec}X)^T}\end{bmatrix}=\begin{bmatrix}\frac{\partial f_{11}}{\partial x_{11}} & \frac{\partial f_{11}}{\partial x_{m1}} & \cdots & \frac{\partial f_{11}}{\partial x_{1n}} & \cdots & \frac{\partial f_{11}}{\partial x_{mn}} \\\frac{\partial f_{p1}}{\partial x_{11}} & \frac{\partial f_{p1}}{\partial x_{m1}} & \cdots & \frac{\partial f_{p1}}{\partial x_{1n}} & \cdots & \frac{\partial f_{p1}}{\partial x_{mn}} \\\vdots & \vdots & & \vdots & & \vdots \\\frac{\partial f_{1q}}{\partial x_{11}} & \frac{\partial f_{1q}}{\partial x_{m1}} & \cdots & \frac{\partial f_{1q}}{\partial x_{1n}} & \cdots & \frac{\partial f_{1q}}{\partial x_{mn}} \\\frac{\partial f_{pq}}{\partial x_{11}} & \frac{\partial f_{pq}}{\partial x_{m1}} & \cdots & \frac{\partial f_{pq}}{\partial x_{1n}} & \cdots & \frac{\partial f_{pq}}{\partial x_{mn}}\end{bmatrix}
  $$

**梯度矩阵**

- 采用列向量形式定义的偏导算子称为列向量偏导算子，习惯称为梯度算子。

  $  m \times 1  $ 列向量偏导算子即梯度算子记作 $  \nabla_x  $，定义为
  $$
  \nabla_x \stackrel{\text{def}}{=} \frac{\partial}{\partial x} = \begin{bmatrix}\frac{\partial}{\partial x_1}, \cdots, \frac{\partial}{\partial x_m}\end{bmatrix}^T
  $$
  因此，实值标量函数 $  f(x)  $ 的梯度向量 $  \nabla_x f(x)  $ 为 $  m \times 1  $ 列向量，定义为
  $$
  \nabla_x f(x) \stackrel{\text{def}}{=} \begin{bmatrix}\frac{\partial f(x)}{\partial x_1}, \cdots, \frac{\partial f(x)}{\partial x_m}\end{bmatrix}^T = \frac{\partial f(x)}{\partial x}
  $$

- 将矩阵变元 $  X  $ 列向量化后，即可直接定义关于矩阵变元 $  X  $ 的梯度算子为

  $$
  \nabla_{\text{vec}X} = \frac{\partial}{\partial \text{vec}X} = \begin{bmatrix}\frac{\partial}{\partial x_{11}}, \cdots, \frac{\partial}{\partial x_{m1}}, \cdots, \frac{\partial}{\partial x_{1n}}, \cdots, \frac{\partial}{\partial x_{mn}}\end{bmatrix}^T
  $$
  由此得到实值标量函数 $  f(X)  $ 关于矩阵变元 $  X  $ 的梯度向量

  $$
  \nabla_{\text{vec}X} f(X) = \frac{\partial f(X)}{\partial \text{vec}X} = \begin{bmatrix}\frac{\partial f(X)}{\partial x_{11}}, \cdots, \frac{\partial f(X)}{\partial x_{m1}}, \cdots, \frac{\partial f(X)}{\partial x_{1n}}, \cdots, \frac{\partial f(X)}{\partial x_{mn}}\end{bmatrix}^T
  $$
  另外，可以直接定义梯度矩阵

  $$
  \nabla_X f(X) = \begin{bmatrix}\frac{\partial f(X)}{\partial x_{11}} & \cdots & \frac{\partial f(X)}{\partial x_{1n}} \\\vdots & \ddots & \vdots \\\frac{\partial f(X)}{\partial x_{m1}} & \cdots & \frac{\partial f(X)}{\partial x_{mn}}\end{bmatrix} = \frac{\partial f(X)}{\partial X}
  $$
  显然，梯度矩阵 $  \nabla_X f(X)  $ 是梯度向量 $  \nabla_{\text{vec}X} f(X)  $ 的矩阵化

  $$
  \nabla_X f(X) = \text{unvec}(\nabla_{\text{vec}X} f(X))
  $$
  比较雅可比和梯度矩阵，又有$$\nabla_X f(X) = D_X^T f(X)$$

  即是说，实值标量函数 $  f(X)  $ 的梯度矩阵等于 Jacobian 矩阵的转置。

下面给出偏导和梯度计算的一些性质：

- **独立性基本假设**
  假定实值函数的向量变元 $  x = [x_i]_{i=1}^m \in \mathbb{R}^m  $ 或者矩阵变元 $  X = [x_{ij}]_{i=1,j=1}^{m,n} \in \mathbb{R}^{m \times n}  $ 本身无任何特殊结构，即向量或矩阵变元的元素之间是各自独立的。

  上述独立性基本假设可以用数学公式表示成

  $$
  \frac{\partial x_i}{\partial x_j} = \delta_{ij} = \begin{cases} 1, & i = j \\0, & \text{其他}\end{cases}
  $$
  以及

  $$
  \frac{\partial x_{kl}}{\partial x_{ij}} = \delta_{ki} \delta_{lj} = \begin{cases} 1, & k = i \ \text{且} \ l = j \\0, & \text{其他}\end{cases}
  $$
  上式分别是一个实值（标量、向量或矩阵）函数关于向量变元和矩阵变元的偏导计算的基本公式。下面举例说明。
  求实值标量函数 $  f(X) = a^T X X^T b  $ 的 Jacobian 矩阵，其中 $  X \in \mathbb{R}^{m \times n}, a, b \in \mathbb{R}^{n \times 1}  $。由于

  $$a^T X X^T b = \sum_{k=1}^{m} \sum_{l=1}^{m} a_k \left( \sum_{p=1}^{n} x_{kp} x_{lp} \right) b_l$$易知

  $$\left[ \frac{\partial f(X)}{\partial X^T} \right]_{ij} = \frac{\partial f(X)}{\partial x_{ji}} = \sum_{k=1}^{m} \sum_{l=1}^{m} \sum_{p=1}^{n} \frac{\partial a_k x_{kp} x_{lp} b_l}{\partial x_{ji}}$$


  $$= \sum_{k=1}^{m} \sum_{l=1}^{m} \sum_{p=1}^{n} \left[ a_k x_{lp} b_l \frac{\partial x_{kp}}{\partial x_{ji}} + a_k x_{kp} b_l \frac{\partial x_{lp}}{\partial x_{ji}} \right]$$


  $$= \sum_{i=1}^{m} \sum_{l=1}^{n} a_j x_{li} b_l + \sum_{k=1}^{m} \sum_{j=1}^{n} a_k x_{ki} b_j$$


  $$= \sum_{i=1}^{m} \sum_{j=1}^{n} \left[ (X^T b)_i a_j + (X^T a)_i b_j \right]$$

  由此得 Jacobian 矩阵和梯度矩阵分别为

  $$D_X f(X) = X^T (ba^T + ab^T) \quad \text{和} \quad \nabla_X f(X) = (ab^T + ba^T) X$$

  

## 一阶实矩阵微分与Jacobian矩阵辨识

- 一阶实矩阵微分：
  - 性质：
    - 转置  矩阵转置的微分等于矩阵微分的转置，即有 $  d(X^T) = (dX)^T  $。
    - 线性  $  d(\alpha X + \beta Y) = \alpha dX + \beta dY  $。

> 先介绍多变量函数的微分，主要是弄清楚，微分$d$和全改变量$\Delta$的区别，知道全微分和线性主部

在多变量函数的微积分中，称多变量函数 $  f(x_1, \cdots, x_m)  $ 在点 $  (x_1, \cdots, x_m)  $ 可微分，若 $  f(x_1, \cdots, x_m)  $ 的全改变量可以写作

$$
\Delta f(x_1, \cdots, x_m) = f(x_1 + \Delta x_1, \cdots, x_m + \Delta x_m) - f(x_1, \cdots, x_m) \\
= A_1 \Delta x_1 + \cdots + A_m \Delta x_m + O(\Delta x_1, \cdots, \Delta x_m)
$$
式中，$  A_1, \cdots, A_m  $ 分别与 $  \Delta x_1, \cdots, \Delta x_m  $ 无关，而 $  O(\Delta x_1, \cdots, \Delta x_m)  $ 表示偏改变量 $  \Delta x_1, \cdots, \Delta x_m  $ 的二阶及高阶项。这时，函数 $  f(x_1, \cdots, x_m)  $ 的偏导数$$\frac{\partial f}{\partial x_1}, \cdots, \frac{\partial f}{\partial x_m}$$一定存在，并且$$\frac{\partial f}{\partial x_1} = A_1, \quad \cdots, \quad \frac{\partial f}{\partial x_m} = A_m$$

全改变量 $  \Delta f(x_1, \cdots, x_m)  $ 的线性主部

$$
A_1 \Delta x_1 + \cdots + A_m \Delta x_m = \frac{\partial f}{\partial x_1} \Delta x_1 + \cdots + \frac{\partial f}{\partial x_m} \Delta x_m
$$
称为多变量函数 $  f(x_1, \cdots, x_m)  $ 的全微分，记为

$$
df(x_1, \cdots, x_m) = \frac{\partial f}{\partial x_1} dx_1 + \cdots + \frac{\partial f}{\partial x_m} dx_m
$$
多变量函数 $  f(x_1, \cdots, x_m)  $ 在点 $  (x_1, \cdots, x_m)  $ 可微分的充分条件是：偏导数$$\frac{\partial f}{\partial x_1}, \cdots, \frac{\partial f}{\partial x_m}$$均存在，并且连续。

一阶实矩阵微分为 Jacobian 矩阵的辨识提供了一种有效的方法。

- 标量函数的Jacobian矩阵辨识

  考虑标量函数 $  f(x)  $，其变元向量 $  x = [x_1, \cdots, x_m]^T \in \mathbb{R}^m  $。将变元向量的元素
  $  x_1, \cdots, x_m  $ 视为 $  m  $ 个变量，可以直接写出以向量为变元的标量函数
  $  f(x)  $ 的全微分表达式
  $$
  df(x) = \frac{\partial f(x)}{\partial x_1} dx_1 + \cdots + \frac{\partial f(x)}{\partial x_m} dx_m \\
  = \begin{bmatrix}\frac{\partial f(x)}{\partial x_1}, \cdots, \frac{\partial f(x)}{\partial x_m}\end{bmatrix}\begin{bmatrix}dx_1 \\\vdots \\dx_m\end{bmatrix}
  $$
  或简记为

  $$
  df(x) = \frac{\partial f(x)}{\partial x^T} dx = (dx)^T \frac{\partial f(x)}{\partial x}
  $$
  式中$$\frac{\partial f(x)}{\partial x^T} = \begin{bmatrix}\frac{\partial f(x)}{\partial x_1}, \cdots, \frac{\partial f(x)}{\partial x_m}\end{bmatrix}$$，$$dx = [dx_1, \cdots, dx_m]^T$$

  上式称为微分法则的向量形式，它启示了一个重要的应用：若令 $  A = \frac{\partial f(x)}{\partial x^T}  $，则一阶微分可以写作迹函数形式

  $$
  df(x) = \frac{\partial f(x)}{\partial x^T} dx = \text{tr}(A dx)
  $$
  这表明，标量函数 $  f(x)  $ 的 Jacobian 矩阵与微分矩阵之间存在等价关系

  $$
  df(x) = \text{tr}(A dx) \iff D_x f(x) = \frac{\partial f(x)}{\partial x^T} = A
  $$
  换言之，若函数 $  f(x)  $ 的微分可以写作 $  df(x) = \text{tr}(A dx)  $，则矩阵 $  A  $ 就是函数 $  f(x)  $ 关于
  其变元向量 $  x  $ 的 Jacobian 矩阵。

- 标量函数与Jacobian矩阵辨识

  当实值标量函数 $  f(X)  $ 的变元为实值矩阵 $  X \in \mathbb{R}^{m \times n}  $ 时，其微分法则的矩阵形式为

  $$
  df(X) = \text{tr}\left(\frac{\partial f(X)}{\partial X} dX\right) = \text{tr}(A dX)
  $$
  式中，$  A = \frac{\partial f(X)}{\partial X}  $ 是实值标量函数 $  f(X)  $ 关于矩阵变元 $  X  $ 的梯度矩阵。根据微分与 Jacobian 矩阵的等价关系，有

  $$
  df(X) = \text{tr}(A dX) \iff \nabla_X f(X) = \frac{\partial f(X)}{\partial X} = A
  $$
  这就是矩阵变元标量函数 Jacobian 矩阵辨识的基本方法。

  **例子：** 计算 $  f(X) = \text{tr}(AXB)  $ 的梯度矩阵，其中 $  A \in \mathbb{R}^{p \times m}, X \in \mathbb{R}^{m \times n}, B \in \mathbb{R}^{n \times q}  $。

  解：首先计算微分
  $$
  df(X) = d(\text{tr}(AXB)) = \text{tr}(A \cdot dX \cdot B) = \text{tr}(A^T B^T dX)
  $$
  因此，$  \nabla_X f(X) = A^T B^T  $。

- 实值矩阵函数的Jacobian矩阵辨识

  对于实值矩阵函数 $  F(X) = [f_{ij}(X)]_{i=1,j=1}^{p,q} \in \mathbb{R}^{p \times q}  $，其中 $  X \in \mathbb{R}^{m \times n}  $，其微分为

  $$
  dF(X) = \left[\frac{\partial f_{ij}(X)}{\partial X}\right]_{i=1,j=1}^{p,q} \cdot dX
  $$
  矩阵函数的 Jacobian 矩阵定义为

  $$
  D_X F(X) = \frac{\partial \text{vec}(F(X))}{\partial (\text{vec}X)^T}
  $$
  具体地，若 $  dF(X)  $ 可以写作

  $$
  \text{vec}(dF(X)) = J \cdot \text{vec}(dX)
  $$
  则 $  J  $ 就是矩阵函数 $  F(X)  $ 的 Jacobian 矩阵 $  D_X F(X)  $。

  **例子：** 计算矩阵函数 $  F(X) = AXB  $ 的 Jacobian 矩阵，其中 $  A \in \mathbb{R}^{p \times m}, X \in \mathbb{R}^{m \times n}, B \in \mathbb{R}^{n \times q}  $。

  解：首先计算微分
  $$
  dF(X) = A \cdot dX \cdot B
  $$
  利用矩阵乘积的向量化性质 $  \text{vec}(AXB) = (B^T \otimes A) \text{vec}(X)  $，得到
  $$
  \text{vec}(dF(X)) = (B^T \otimes A) \text{vec}(dX)
  $$
  因此，$  D_X F(X) = B^T \otimes A  $。



## 二阶实矩阵微分与Hessian矩阵辨识

二阶微分用于研究函数的二阶性质，特别是在优化问题中的凸性和稳定性分析。

- **二阶微分的定义**
  对于实值标量函数 $  f(X)  $，其中 $  X \in \mathbb{R}^{m \times n}  $，一阶微分为
  $$
  df(X) = \text{tr}\left(\frac{\partial f(X)}{\partial X} dX\right)
  $$
  二阶微分定义为一阶微分的微分：
  $$
  d^2f(X) = d\left(\text{tr}\left(\frac{\partial f(X)}{\partial X} dX\right)\right)
  $$

- **Hessian矩阵**
  实值标量函数 $  f(X)  $ 的 Hessian 矩阵是关于 $  \text{vec}(X)  $ 的二阶偏导矩阵：
  $$
  H_f(X) = \frac{\partial^2 f(X)}{\partial \text{vec}(X) \partial (\text{vec}(X))^T} \in \mathbb{R}^{mn \times mn}
  $$
  Hessian 矩阵的 $(i,j)$ 元素为
  $$
  [H_f(X)]_{ij} = \frac{\partial^2 f(X)}{\partial (\text{vec}(X))_i \partial (\text{vec}(X))_j}
  $$

- **二阶微分与Hessian矩阵的关系**
  若函数 $  f(X)  $ 二次可微，则其二阶微分可以表示为
  $$
  d^2f(X) = (\text{vec}(dX))^T H_f(X) \text{vec}(dX)
  $$
  这一关系是 Hessian 矩阵辨识的基础。

- **Hessian矩阵的性质**
  1. **对称性**：如果 $  f(X)  $ 的混合偏导数连续，则 Hessian 矩阵是对称的，即 $  H_f(X) = H_f^T(X)  $。
  
  2. **正定性与凸性**：
     - 若 $  H_f(X) > 0  $（正定），则 $  f(X)  $ 在 $  X  $ 处是严格凸函数。
     - 若 $  H_f(X) \geq 0  $（半正定），则 $  f(X)  $ 在 $  X  $ 处是凸函数。

  **例子：** 计算二次函数 $  f(X) = \text{tr}(X^T A X)  $ 的 Hessian 矩阵，其中 $  A \in \mathbb{R}^{n \times n}  $ 是对称矩阵，$  X \in \mathbb{R}^{n \times n}  $。

  解：首先计算一阶微分
  $$
  df(X) = \text{tr}(dX^T A X + X^T A dX) = \text{tr}((A + A^T)X dX) = \text{tr}(2AX dX)
  $$
  因此，梯度矩阵为 $  \nabla_X f(X) = 2AX  $。

  计算二阶微分
  $$
  d^2f(X) = \text{tr}(2A dX dX) = 2 \text{tr}(A dX dX)
  $$
  利用 $  \text{tr}(A dX dX) = (\text{vec}(dX))^T (I \otimes A) \text{vec}(dX)  $，得到
  $$
  d^2f(X) = 2(\text{vec}(dX))^T (I \otimes A) \text{vec}(dX)
  $$
  因此，Hessian 矩阵为 $  H_f(X) = 2(I \otimes A)  $。

- Hessian矩阵的辨识，详情可见书中的Hessian矩阵辨识表




## 共轭梯度与复Hessian矩阵

当处理复值函数时，需要引入共轭梯度的概念，因为复函数的微分性质与实函数有显著差异。

- **复值函数的微分**
  对于复值标量函数 $  f(Z)  $，其中 $  Z \in \mathbb{C}^{m \times n}  $，如果将 $  Z = X + jY  $，其中 $  X, Y \in \mathbb{R}^{m \times n}  $，则函数 $  f(Z)  $ 可以看作是关于实部 $  X  $ 和虚部 $  Y  $ 的实值函数。

- **Wirtinger导数**
  为了处理复值函数，引入 Wirtinger 导数的概念：
  $$
  \frac{\partial f}{\partial z} = \frac{1}{2}\left(\frac{\partial f}{\partial x} - j\frac{\partial f}{\partial y}\right)
  $$
  $$
  \frac{\partial f}{\partial \bar{z}} = \frac{1}{2}\left(\frac{\partial f}{\partial x} + j\frac{\partial f}{\partial y}\right)
  $$
  其中 $  z = x + jy  $，$  \bar{z} = x - jy  $ 是 $  z  $ 的共轭。

- **共轭梯度矩阵**
  对于复矩阵变元 $  Z \in \mathbb{C}^{m \times n}  $，定义复值标量函数 $  f(Z)  $ 的共轭梯度矩阵为
  $$
  \nabla_{\bar{Z}} f(Z) = \frac{\partial f(Z)}{\partial \bar{Z}} = \begin{bmatrix}\frac{\partial f(Z)}{\partial \bar{z}_{11}} & \cdots & \frac{\partial f(Z)}{\partial \bar{z}_{1n}} \\\vdots & \ddots & \vdots \\\frac{\partial f(Z)}{\partial \bar{z}_{m1}} & \cdots & \frac{\partial f(Z)}{\partial \bar{z}_{mn}}\end{bmatrix}
  $$

- **复Hessian矩阵**
  复值函数的 Hessian 矩阵具有更复杂的结构，包括四个分块：
  $$
  H_f(Z) = \begin{bmatrix}
  \frac{\partial^2 f}{\partial Z \partial Z^T} & \frac{\partial^2 f}{\partial Z \partial \bar{Z}^T} \\
  \frac{\partial^2 f}{\partial \bar{Z} \partial Z^T} & \frac{\partial^2 f}{\partial \bar{Z} \partial \bar{Z}^T}
  \end{bmatrix}
  $$

- **微分形式**
  复值函数的微分可以表示为
  $$
  df(Z) = \text{tr}\left(\frac{\partial f}{\partial Z} dZ\right) + \text{tr}\left(\frac{\partial f}{\partial \bar{Z}} d\bar{Z}\right)
  $$
  对于解析函数（全纯函数），有 $  \frac{\partial f}{\partial \bar{Z}} = 0  $，此时微分简化为
  $$
  df(Z) = \text{tr}\left(\frac{\partial f}{\partial Z} dZ\right)
  $$

  **例子：** 计算复二次函数 $  f(Z) = Z^H A Z  $ 的共轭梯度，其中 $  A  $ 是 Hermite 矩阵，$  Z \in \mathbb{C}^{n \times 1}  $。

  解：将 $  Z = X + jY  $，则
  $$
  f(Z) = (X - jY)^T A (X + jY) = X^T A X + Y^T A Y + j(X^T A Y - Y^T A X)
  $$
  计算共轭梯度
  $$
  \nabla_{\bar{Z}} f(Z) = \frac{\partial f}{\partial \bar{Z}} = AZ
  $$





## 复梯度矩阵与复Hessian矩阵的辨识

复函数的梯度和 Hessian 矩阵辨识需要考虑函数关于复变量及其共轭的偏导数。

- **复梯度矩阵的辨识方法**
  对于复值标量函数 $  f(Z)  $，其中 $  Z \in \mathbb{C}^{m \times n}  $，微分可以写作
  $$
  df(Z) = \text{tr}(A dZ) + \text{tr}(B d\bar{Z})
  $$
  则有
  $$
  \frac{\partial f}{\partial Z} = A^T, \quad \frac{\partial f}{\partial \bar{Z}} = B^T
  $$

- **复Hessian矩阵的结构**
  复值函数的完整 Hessian 矩阵为 $  2mn \times 2mn  $ 的分块矩阵：
  $$
  H_f = \begin{bmatrix}
  H_{ZZ} & H_{Z\bar{Z}} \\
  H_{\bar{Z}Z} & H_{\bar{Z}\bar{Z}}
  \end{bmatrix}
  $$
  其中：
  - $  H_{ZZ} = \frac{\partial^2 f}{\partial \text{vec}(Z) \partial (\text{vec}(Z))^T}  $
  - $  H_{Z\bar{Z}} = \frac{\partial^2 f}{\partial \text{vec}(Z) \partial (\text{vec}(\bar{Z}))^T}  $
  - $  H_{\bar{Z}Z} = \frac{\partial^2 f}{\partial \text{vec}(\bar{Z}) \partial (\text{vec}(Z))^T}  $
  - $  H_{\bar{Z}\bar{Z}} = \frac{\partial^2 f}{\partial \text{vec}(\bar{Z}) \partial (\text{vec}(\bar{Z}))^T}  $

- **实用的辨识技巧**
  
  1. **利用实部和虚部分离**：将复变量 $  Z = X + jY  $ 分离，然后分别对实部和虚部求导。
  
  2. **利用共轭对称性**：如果函数 $  f(Z)  $ 是实值的，则有
     $$
     \frac{\partial f}{\partial Z} = \left(\frac{\partial f}{\partial \bar{Z}}\right)^*
     $$
  
  3. **链式法则的复形式**：
     $$
     \frac{\partial f(g(Z))}{\partial Z} = \frac{\partial f}{\partial g} \frac{\partial g}{\partial Z} + \frac{\partial f}{\partial \bar{g}} \frac{\partial \bar{g}}{\partial Z}
     $$

- **常用复函数的梯度公式**
  
  1. $  f(Z) = \text{tr}(Z^H A Z)  $：$  \nabla_{\bar{Z}} f = AZ  $
  
  2. $  f(Z) = \text{tr}(Z Z^H)  $：$  \nabla_{\bar{Z}} f = Z  $
  
  3. $  f(Z) = \|Z\|_F^2 = \text{tr}(Z^H Z)  $：$  \nabla_{\bar{Z}} f = Z  $
  
  4. $  f(Z) = \text{tr}(A Z B Z^H)  $：$  \nabla_{\bar{Z}} f = A^H \bar{Z} B^H  $

  **例子：** 计算复函数 $  f(Z) = \text{tr}(Z^H A Z B Z^H C)  $ 的共轭梯度，其中所有矩阵维数匹配。

  解：设 $  Z \in \mathbb{C}^{m \times n}  $，使用微分方法：
  $$
  df(Z) = \text{tr}(dZ^H A Z B Z^H C) + \text{tr}(Z^H A dZ B Z^H C) + \text{tr}(Z^H A Z B dZ^H C)
  $$
  
  利用迹的循环性质和共轭转置的性质，可以得到
  $$
  df(Z) = \text{tr}((C Z B^H Z^H A^H + A Z B Z^H C) d\bar{Z})
  $$
  
  因此
  $$
  \nabla_{\bar{Z}} f(Z) = C Z B^H Z^H A^H + A Z B Z^H C
  $$

- **优化中的应用**
  在复优化问题中，如果目标函数 $  f(Z)  $ 是实值的，则最优性条件为
  $$
  \frac{\partial f}{\partial \bar{Z}} = 0
  $$
  这等价于梯度的实部和虚部都为零，即
  $$
  \text{Re}\left(\frac{\partial f}{\partial \bar{Z}}\right) = 0, \quad \text{Im}\left(\frac{\partial f}{\partial \bar{Z}}\right) = 0
  $$













